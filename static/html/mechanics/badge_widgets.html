<head>
<!-- Font Awesome Icon Library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<style>

.bdg-container{
	position: relative;
}
.bdg-container > div{
    font-size: 30px;
    padding: .5em;
    margin: .5em;
    text-align: center;
    width:90%;
    font-size:calc(1em + 1vw);
}
.bdg-container > div > img{
    width: 25%;
    height: 60%;
    -webkit-transition: .15s;
    transition: .15s; 
}
/*Transversal style for valoration and link*/
/*.discover {
	position: absolute;
    bottom: 0;
    right: 0;
    cursor:pointer;
    font-size: calc(0.8em + 0.8vw);
}
.valoration{
	margin-top:-10px;
	position: absolute;
    top: 0;
    right: 0;
}

.fa-star{
	cursor:pointer;
	font-size: calc(0.8em + 0.8vw);
}*/
</style>

<div id = "bdg-widget-dynamic_index" class="bdg-container"></div>
<param id = "bdg-widget-handshake-dynamic_index" value=0></param> 

<script>

    //INTERACTION INIT -----------------------------------------------------------------------
    //Dynamic property :: Log tracking functions
    include-base-tracking
    include-onclick-tracking
    start_main_time();
    start_focus_time("bdg-widget-dynamic_index");
    start_logs(log,"dynamic_user", "dynamic_mechanic_index",16);
    set_widget_defaults("#bdg-widget-dynamic_index", "dynamic_mechanic_index", "dynamic_link_url");
    // ---------------------------------------------------------------------------------------
    

/*function valorate(stars){
	for(var i = 1; i <= 5; i++){
		if(i <= stars){
			document.querySelector("#star-" + i + "-dynamic_index").style.color = "orange"; 
		}else{
			document.querySelector("#star-" + i + "-dynamic_index").style.color = "black"; 
		}
		
	}
}*/

document.querySelector("#bdg-widget-handshake-dynamic_index").value = 1;
function log_bdg_click(){
          // INTERACTION OCCURRENCE REGISTRATION --------------------------------------
          //Logging :: button-click interaction
          log_click({itime: 2, message:"Badge icon clicked", register : log, level:1,type:"ImageClick"});
           // --------------------------------------------------------------------------
          };
function choose_bdg(badge){
	var locked_style = "";
    if(badge[1]){
        locked_style = 'The last badge you won: '; 
    }else{
    	  locked_style = 'You won a new badge: ';
    } 
    
   	document.querySelector("#bdg-widget-dynamic_index").innerHTML += '<div><h4>' + locked_style + badge[0].title + '</h4><img onclick="log_bdg_click();" id="bdg-icon-dynamic_index" src="' + badge[0].icon + '"/></div>';
  
   	/*document.querySelector("#bdg-widget-dynamic_index").innerHTML += '<p class="valoration">'+
    																	'<span id="star-1-dynamic_index" onclick="valorate(1);" class="fa fa-star"></span>'+
																		'<span id="star-2-dynamic_index" onclick="valorate(2);" class="fa fa-star"></span>'+
																		'<span id="star-3-dynamic_index" onclick="valorate(3);" class="fa fa-star"></span>'+
																		'<span id="star-4-dynamic_index" onclick="valorate(4);" class="fa fa-star"></span>'+
																		'<span id="star-5-dynamic_index" onclick="valorate(5);" class="fa fa-star"></span><br>'+
																	'</p>' + 
																	 '<br><a href="https://consumerbrandbuilders.com/wp-content/uploads/2013/02/Well-Done.jpg" class="discover">Discover more \> </a>';
	*/
}
url = "https://agmodule.herokuapp.com/api/badges/retrieve_for_user/dynamic_user?unlock=true&widget_id=dynamic_index";
fetch(url)
.then(response => response.json())
.then(res_json => (res_json.results))
.then((list) => (list[0]))
.then((badge) => (choose_bdg(badge)))
.catch(error => (console.log("Error: " + error)))
</script>